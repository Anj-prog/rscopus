<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gathering Multiple Subject Queries with Large Numbers of Authors • rscopus</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Gathering Multiple Subject Queries with Large Numbers of Authors">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rscopus</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.6.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/api_key.html">Setting up the Scopus API Key</a>
    </li>
    <li>
      <a href="../articles/multi_author.html">Gathering Multiple Subject Queries with Large Numbers of Authors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/muschellij2/rscopus">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Gathering Multiple Subject Queries with Large Numbers of Authors</h1>
                        <h4 class="author">John Muschelli and Clarke Iakovakis</h4>
            
            <h4 class="date">2018-12-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/muschellij2/rscopus/blob/master/vignettes/multi_author.Rmd"><code>vignettes/multi_author.Rmd</code></a></small>
      <div class="hidden name"><code>multi_author.Rmd</code></div>

    </div>

    
    
<p>In <code>rscopus</code> we try to use the Scopus API to present queries about authors and affiliations. Here we will use an example from Clarke Iakovakis.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>First, let’s load in the packages we’ll need.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(<span class="st">"rscopus"</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(<span class="st">"dplyr"</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(<span class="st">"tidyr"</span>)</a></code></pre></div>
<p>Next, we need to see if we have an API key available. See the API key vignette for more information and how to set the keys up. We will use the <code><a href="../reference/get_api_key.html">have_api_key()</a></code> functionality.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="../reference/get_api_key.html">have_api_key</a></span>()</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
<div id="creating-a-query" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-query" class="anchor"></a>Creating a query</h2>
<p>Here we will create a query of a specific affiliation, subject area, publication year, and type of access (OA = open access). Let’s look at the different types of subject areas:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">rscopus<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rscopus/topics/subject_areas">subject_areas</a></span>()</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">#&gt;  [1] "AGRI" "ARTS" "BIOC" "BUSI" "CENG" "CHEM" "COMP" "DECI" "DENT" "EART"</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">#&gt; [11] "ECON" "ENER" "ENGI" "ENVI" "HEAL" "IMMU" "MATE" "MATH" "MEDI" "NEUR"</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">#&gt; [21] "NURS" "PHAR" "PHYS" "PSYC" "SOCI" "VETE" "MULT"</span></a></code></pre></div>
<p>These categories are helpful because to search all the documents it’d be too big of a call. We may also get rate limited. We can search each separately, store the information, save them, merge them, and then run our results.</p>
<p>The author of this example was analyzing data from OSU (Oklahoma State University), and uses the affiliation ID from that institution (<code>60006514</code>). If you know the institution name, but not the ID, you can use <code>process_affiliation_name</code> to retrieve it. Here we make the queries for each subject area:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># create the query</span></a>
<a class="sourceLine" id="cb4-2" title="2">Query &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"AF-ID(60006514) AND SUBJAREA("</span>, </a>
<a class="sourceLine" id="cb4-3" title="3">                <span class="kw"><a href="../reference/subject_areas.html">subject_areas</a></span>(), </a>
<a class="sourceLine" id="cb4-4" title="4">                <span class="st">") AND PUBYEAR = 2018 AND ACCESSTYPE(OA)"</span>)</a></code></pre></div>
</div>
<div id="running-the-query" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-query" class="anchor"></a>Running the query</h2>
<p>Let’s pull the first subject area information. Note, the count may depend on your API key limits. We also are asking for a complete view, rather than the standard view. The <code>max_count</code> is set to <span class="math inline">\(20000\)</span>, so this may not be enough for your query and you need to adjust.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="cf">if</span> (<span class="kw"><a href="../reference/get_api_key.html">have_api_key</a></span>()) {</a>
<a class="sourceLine" id="cb5-2" title="2">  make_query =<span class="st"> </span><span class="cf">function</span>(subj_area) {</a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="kw">paste0</span>(<span class="st">"AF-ID(60006514) AND SUBJAREA("</span>, </a>
<a class="sourceLine" id="cb5-4" title="4">           subj_area,</a>
<a class="sourceLine" id="cb5-5" title="5">           <span class="st">") AND PUBYEAR = 2018 AND ACCESSTYPE(OA)"</span>)</a>
<a class="sourceLine" id="cb5-6" title="6">  }</a>
<a class="sourceLine" id="cb5-7" title="7">  i =<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb5-8" title="8">  subj_area =<span class="st"> </span><span class="kw"><a href="../reference/subject_areas.html">subject_areas</a></span>()[i]</a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="kw">print</span>(subj_area)</a>
<a class="sourceLine" id="cb5-10" title="10">  completeArticle &lt;-<span class="st"> </span><span class="kw"><a href="../reference/scopus_search.html">scopus_search</a></span>(</a>
<a class="sourceLine" id="cb5-11" title="11">    <span class="dt">query =</span> <span class="kw">make_query</span>(subj_area), </a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="dt">view =</span> <span class="st">"COMPLETE"</span>, </a>
<a class="sourceLine" id="cb5-13" title="13">    <span class="dt">count =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb5-14" title="14">  <span class="kw">print</span>(<span class="kw">names</span>(completeArticle))</a>
<a class="sourceLine" id="cb5-15" title="15">  total_results =<span class="st"> </span>completeArticle<span class="op">$</span>total_results</a>
<a class="sourceLine" id="cb5-16" title="16">  total_results =<span class="st"> </span><span class="kw">as.numeric</span>(total_results)</a>
<a class="sourceLine" id="cb5-17" title="17">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb5-18" title="18">  total_results =<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb5-19" title="19">}</a>
<a class="sourceLine" id="cb5-20" title="20"><span class="co">#&gt; [1] "BIOC"</span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">#&gt; Warning in scopus_search(query = make_query(subj_area), view =</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">#&gt; "COMPLETE", : STANDARD view can have a max count of 200 and COMPLETE 25</span></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="co">#&gt; The query list is:</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="co">#&gt; list(query = "AF-ID(60006514) AND SUBJAREA(BIOC) AND PUBYEAR = 2018 AND ACCESSTYPE(OA)", </span></a>
<a class="sourceLine" id="cb5-25" title="25"><span class="co">#&gt;     count = 25, start = 0, view = "COMPLETE")</span></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="co">#&gt; $query</span></a>
<a class="sourceLine" id="cb5-27" title="27"><span class="co">#&gt; [1] "AF-ID(60006514) AND SUBJAREA(BIOC) AND PUBYEAR = 2018 AND ACCESSTYPE(OA)"</span></a>
<a class="sourceLine" id="cb5-28" title="28"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-29" title="29"><span class="co">#&gt; $count</span></a>
<a class="sourceLine" id="cb5-30" title="30"><span class="co">#&gt; [1] 25</span></a>
<a class="sourceLine" id="cb5-31" title="31"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-32" title="32"><span class="co">#&gt; $start</span></a>
<a class="sourceLine" id="cb5-33" title="33"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb5-34" title="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-35" title="35"><span class="co">#&gt; $view</span></a>
<a class="sourceLine" id="cb5-36" title="36"><span class="co">#&gt; [1] "COMPLETE"</span></a>
<a class="sourceLine" id="cb5-37" title="37"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-38" title="38"><span class="co">#&gt; Response [https://api.elsevier.com/content/search/scopus?query=AF-ID%2860006514%29%20AND%20SUBJAREA%28BIOC%29%20AND%20PUBYEAR%20%3D%202018%20AND%20ACCESSTYPE%28OA%29&amp;count=25&amp;start=0&amp;view=COMPLETE]</span></a>
<a class="sourceLine" id="cb5-39" title="39"><span class="co">#&gt;   Date: 2018-12-19 23:30</span></a>
<a class="sourceLine" id="cb5-40" title="40"><span class="co">#&gt;   Status: 200</span></a>
<a class="sourceLine" id="cb5-41" title="41"><span class="co">#&gt;   Content-Type: application/json;charset=UTF-8</span></a>
<a class="sourceLine" id="cb5-42" title="42"><span class="co">#&gt;   Size: 160 kB</span></a>
<a class="sourceLine" id="cb5-43" title="43"><span class="co">#&gt; Total Entries are 66</span></a>
<a class="sourceLine" id="cb5-44" title="44"><span class="co">#&gt; 3 runs need to be sent with current count</span></a>
<a class="sourceLine" id="cb5-45" title="45"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-46" title="46">  <span class="op">|</span><span class="st">                                                                       </span></a>
<a class="sourceLine" id="cb5-47" title="47"><span class="st">  </span><span class="er">|</span><span class="st">                                                                 </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb5-48" title="48">  <span class="op">|</span><span class="st">                                                                       </span></a>
<a class="sourceLine" id="cb5-49" title="49"><span class="st">  </span><span class="er">|=================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a>
<a class="sourceLine" id="cb5-50" title="50"><span class="co">#&gt; Number of Output Entries are 66</span></a>
<a class="sourceLine" id="cb5-51" title="51"><span class="co">#&gt; [1] "entries"        "total_results"  "get_statements"</span></a></code></pre></div>
<p>Here we see the total results of the query. This can be useful if the <code>total_results = 0</code> or they are greater than the max count specified (not all records in Scopus are returned).</p>
</div>
<div id="getting-the-content" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-the-content" class="anchor"></a>Getting the content</h2>
<p>The <code>gen_entries_to_df</code> function is an attempt at turning the parsed JSON to something more manageable from the API output. You may want to go over the list elements <code>get_statements</code> in the output of <code>completeArticle</code>. The original content can be extracted using <code><a href="http://www.rdocumentation.org/packages/httr/topics/content">httr::content()</a></code> and the <code>"type"</code> can be specified, such as <code>"text"</code> and then <code><a href="http://www.rdocumentation.org/packages/jsonlite/topics/fromJSON">jsonlite::toJSON</a></code> can be used explicitly on the JSON output. Alternatively, any arguments to <code><a href="http://www.rdocumentation.org/packages/jsonlite/topics/fromJSON">jsonlite::toJSON</a></code> can be passed directly into <code><a href="http://www.rdocumentation.org/packages/httr/topics/content">httr::content()</a></code>, such as <code>flatten</code> or <code>simplifyDataFrame</code>.</p>
<p>These are all alternative options, but we will use <code>rscopous::gen_entries_to_df</code>. The output is a list of <code>data.frame</code>s after we pass in the <code>entries</code> elements from the list.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="cf">if</span> (<span class="kw"><a href="../reference/get_api_key.html">have_api_key</a></span>()) {</a>
<a class="sourceLine" id="cb6-2" title="2">  </a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="co"># areas = subject_areas()[12:13]  </span></a>
<a class="sourceLine" id="cb6-4" title="4">  areas =<span class="st"> </span><span class="kw">c</span>(<span class="st">"ENER"</span>, <span class="st">"ENGI"</span>)</a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="kw">names</span>(areas) =<span class="st"> </span>areas</a>
<a class="sourceLine" id="cb6-6" title="6">  results =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(</a>
<a class="sourceLine" id="cb6-7" title="7">    areas,</a>
<a class="sourceLine" id="cb6-8" title="8">    <span class="cf">function</span>(subj_area) {</a>
<a class="sourceLine" id="cb6-9" title="9">      <span class="kw">print</span>(subj_area)</a>
<a class="sourceLine" id="cb6-10" title="10">      completeArticle &lt;-<span class="st"> </span><span class="kw"><a href="../reference/scopus_search.html">scopus_search</a></span>(</a>
<a class="sourceLine" id="cb6-11" title="11">        <span class="dt">query =</span> <span class="kw">make_query</span>(subj_area), </a>
<a class="sourceLine" id="cb6-12" title="12">        <span class="dt">view =</span> <span class="st">"COMPLETE"</span>, </a>
<a class="sourceLine" id="cb6-13" title="13">        <span class="dt">count =</span> <span class="dv">200</span>,</a>
<a class="sourceLine" id="cb6-14" title="14">        <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb6-15" title="15">      <span class="kw">return</span>(completeArticle)</a>
<a class="sourceLine" id="cb6-16" title="16">    })</a>
<a class="sourceLine" id="cb6-17" title="17">  entries =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(results, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb6-18" title="18">    x<span class="op">$</span>entries</a>
<a class="sourceLine" id="cb6-19" title="19">  })</a>
<a class="sourceLine" id="cb6-20" title="20">  total_results =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(results, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb6-21" title="21">    <span class="kw">as.numeric</span>(x<span class="op">$</span>total_results)</a>
<a class="sourceLine" id="cb6-22" title="22">  })  </a>
<a class="sourceLine" id="cb6-23" title="23">  total_results =<span class="st"> </span><span class="kw">sum</span>(total_results, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-24" title="24">  </a>
<a class="sourceLine" id="cb6-25" title="25">  df =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(entries, gen_entries_to_df)</a>
<a class="sourceLine" id="cb6-26" title="26">  MainEntry =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(df, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb6-27" title="27">    x<span class="op">$</span>df</a>
<a class="sourceLine" id="cb6-28" title="28">  }, <span class="dt">.id =</span> <span class="st">"subj_area"</span>)</a>
<a class="sourceLine" id="cb6-29" title="29">  <span class="kw">print</span>(<span class="kw">head</span>(MainEntry <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="st">               </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">as.numeric</span>(<span class="st">`</span><span class="dt">author-count.$</span><span class="st">`</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">99</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="st">               </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(message, <span class="st">`</span><span class="dt">author-count.$</span><span class="st">`</span>)))  </a>
<a class="sourceLine" id="cb6-32" title="32">  </a>
<a class="sourceLine" id="cb6-33" title="33">  MainEntry =<span class="st"> </span>MainEntry <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-34" title="34"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb6-35" title="35">      <span class="dt">scopus_id =</span> <span class="kw">sub</span>(<span class="st">"SCOPUS_ID:"</span>, <span class="st">""</span>, <span class="st">`</span><span class="dt">dc:identifier</span><span class="st">`</span>),</a>
<a class="sourceLine" id="cb6-36" title="36">      <span class="dt">entry_number =</span> <span class="kw">as.numeric</span>(entry_number),</a>
<a class="sourceLine" id="cb6-37" title="37">      <span class="dt">doi =</span> <span class="st">`</span><span class="dt">prism:doi</span><span class="st">`</span>)    </a>
<a class="sourceLine" id="cb6-38" title="38">  <span class="co">#################################</span></a>
<a class="sourceLine" id="cb6-39" title="39">  <span class="co"># remove duplicated entries</span></a>
<a class="sourceLine" id="cb6-40" title="40">  <span class="co">#################################</span></a>
<a class="sourceLine" id="cb6-41" title="41">  MainEntry =<span class="st"> </span>MainEntry <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-42" title="42"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw">duplicated</span>(scopus_id))  </a>
<a class="sourceLine" id="cb6-43" title="43">  </a>
<a class="sourceLine" id="cb6-44" title="44">  Authors =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(df, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb6-45" title="45">    x<span class="op">$</span>author</a>
<a class="sourceLine" id="cb6-46" title="46">  }, <span class="dt">.id =</span> <span class="st">"subj_area"</span>)  </a>
<a class="sourceLine" id="cb6-47" title="47">  Authors<span class="op">$</span><span class="st">`</span><span class="dt">afid.@_fa</span><span class="st">`</span> =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb6-48" title="48">  </a>
<a class="sourceLine" id="cb6-49" title="49">  Affiliation =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(df, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb6-50" title="50">    x<span class="op">$</span>affiliation</a>
<a class="sourceLine" id="cb6-51" title="51">  }, <span class="dt">.id =</span> <span class="st">"subj_area"</span>)    </a>
<a class="sourceLine" id="cb6-52" title="52">  Affiliation<span class="op">$</span><span class="st">`</span><span class="dt">@_fa</span><span class="st">`</span> =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb6-53" title="53">  </a>
<a class="sourceLine" id="cb6-54" title="54">  <span class="co"># keep only these non-duplicated records</span></a>
<a class="sourceLine" id="cb6-55" title="55">  MainEntry_id =<span class="st"> </span>MainEntry <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-56" title="56"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(entry_number, subj_area)</a>
<a class="sourceLine" id="cb6-57" title="57">  Authors =<span class="st"> </span>Authors <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-58" title="58"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">entry_number =</span> <span class="kw">as.numeric</span>(entry_number))</a>
<a class="sourceLine" id="cb6-59" title="59">  </a>
<a class="sourceLine" id="cb6-60" title="60">  Affiliation =<span class="st"> </span>Affiliation <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-61" title="61"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">entry_number =</span> <span class="kw">as.numeric</span>(entry_number))    </a>
<a class="sourceLine" id="cb6-62" title="62">  </a>
<a class="sourceLine" id="cb6-63" title="63">  Authors =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(MainEntry_id, Authors)</a>
<a class="sourceLine" id="cb6-64" title="64">  Affiliation =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(MainEntry_id, Affiliation)</a>
<a class="sourceLine" id="cb6-65" title="65">  </a>
<a class="sourceLine" id="cb6-66" title="66">  </a>
<a class="sourceLine" id="cb6-67" title="67">  <span class="co"># first filter to get only OSU authors</span></a>
<a class="sourceLine" id="cb6-68" title="68">  osuauth &lt;-<span class="st"> </span>Authors <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-69" title="69"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="st">`</span><span class="dt">afid.$</span><span class="st">`</span> <span class="op">==</span><span class="st"> "60006514"</span>)</a>
<a class="sourceLine" id="cb6-70" title="70">  </a>
<a class="sourceLine" id="cb6-71" title="71">}</a>
<a class="sourceLine" id="cb6-72" title="72"><span class="co">#&gt; [1] "ENER"</span></a>
<a class="sourceLine" id="cb6-73" title="73"><span class="co">#&gt; Warning in scopus_search(query = make_query(subj_area), view =</span></a>
<a class="sourceLine" id="cb6-74" title="74"><span class="co">#&gt; "COMPLETE", : STANDARD view can have a max count of 200 and COMPLETE 25</span></a>
<a class="sourceLine" id="cb6-75" title="75"><span class="co">#&gt; [1] "ENGI"</span></a>
<a class="sourceLine" id="cb6-76" title="76"><span class="co">#&gt; Warning in scopus_search(query = make_query(subj_area), view =</span></a>
<a class="sourceLine" id="cb6-77" title="77"><span class="co">#&gt; "COMPLETE", : STANDARD view can have a max count of 200 and COMPLETE 25</span></a>
<a class="sourceLine" id="cb6-78" title="78"><span class="co">#&gt;                                                                                           message</span></a>
<a class="sourceLine" id="cb6-79" title="79"><span class="co">#&gt; 1 Author list of 109 truncated at 100; retrieve the full abstract for a complete list of authors.</span></a>
<a class="sourceLine" id="cb6-80" title="80"><span class="co">#&gt; 2 Author list of 111 truncated at 100; retrieve the full abstract for a complete list of authors.</span></a>
<a class="sourceLine" id="cb6-81" title="81"><span class="co">#&gt; 3 Author list of 113 truncated at 100; retrieve the full abstract for a complete list of authors.</span></a>
<a class="sourceLine" id="cb6-82" title="82"><span class="co">#&gt; 4 Author list of 110 truncated at 100; retrieve the full abstract for a complete list of authors.</span></a>
<a class="sourceLine" id="cb6-83" title="83"><span class="co">#&gt; 5 Author list of 109 truncated at 100; retrieve the full abstract for a complete list of authors.</span></a>
<a class="sourceLine" id="cb6-84" title="84"><span class="co">#&gt; 6 Author list of 109 truncated at 100; retrieve the full abstract for a complete list of authors.</span></a>
<a class="sourceLine" id="cb6-85" title="85"><span class="co">#&gt;   author-count.$</span></a>
<a class="sourceLine" id="cb6-86" title="86"><span class="co">#&gt; 1            109</span></a>
<a class="sourceLine" id="cb6-87" title="87"><span class="co">#&gt; 2            111</span></a>
<a class="sourceLine" id="cb6-88" title="88"><span class="co">#&gt; 3            113</span></a>
<a class="sourceLine" id="cb6-89" title="89"><span class="co">#&gt; 4            110</span></a>
<a class="sourceLine" id="cb6-90" title="90"><span class="co">#&gt; 5            109</span></a>
<a class="sourceLine" id="cb6-91" title="91"><span class="co">#&gt; 6            109</span></a>
<a class="sourceLine" id="cb6-92" title="92"><span class="co">#&gt; Joining, by = c("entry_number", "subj_area")</span></a>
<a class="sourceLine" id="cb6-93" title="93"><span class="co">#&gt; Joining, by = c("entry_number", "subj_area")</span></a></code></pre></div>
<p>At the end of the day, we have the author-level information for each paper. The <code>entry_number</code> will join these <code>data.frame</code>s if necessary. The <code>df</code> element has the paper-level information in this example, the <code>author</code> <code>data.frame</code> has author information, including affiliations. There can be multiple affiliations, even within institution, such as multiple department affiliations within an institution affiliation. The <code>affiliation</code> information relates to the affiliations and can be merged with the author information.</p>
</div>
<div id="funding-agencies" class="section level2">
<h2 class="hasAnchor">
<a href="#funding-agencies" class="anchor"></a>Funding agencies</h2>
<p>Here we look at the funding agencies listed on all the papers. This can show us if there is a pattern in the funding sponsor and the open-access publications. Overall, though, we would like to see the funding of all the papers if a specific funder requires open access. This checking allows libraries and researchers ensure they are following the guidelines of the funding agency.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">cn =<span class="st"> </span><span class="kw">colnames</span>(MainEntry)</a>
<a class="sourceLine" id="cb7-2" title="2">cn[<span class="kw">grep</span>(<span class="st">"fund"</span>, <span class="kw">tolower</span>(cn))]</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt; [1] "fund-no"      "fund-acr"     "fund-sponsor"</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw">tail</span>(<span class="kw">sort</span>(<span class="kw">table</span>(MainEntry<span class="op">$</span><span class="st">`</span><span class="dt">fund-sponsor</span><span class="st">`</span>)))</a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt;                U.S. Department of Agriculture </span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt;                                             1 </span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt;                   National Science Foundation </span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt;                                             2 </span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt; Natural Science Foundation of Fujian Province </span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt;                                             2 </span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt;                     Oklahoma State University </span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt;                                             2 </span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt;  National Natural Science Foundation of China </span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt;                                             3 </span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt;     Ministerstwo Nauki i Szkolnictwa Wyższego </span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt;                                            20</span></a>
<a class="sourceLine" id="cb7-19" title="19"></a>
<a class="sourceLine" id="cb7-20" title="20">funderPoland &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(</a>
<a class="sourceLine" id="cb7-21" title="21">  MainEntry, </a>
<a class="sourceLine" id="cb7-22" title="22">  <span class="st">`</span><span class="dt">fund-sponsor</span><span class="st">`</span> <span class="op">==</span><span class="st"> "Ministerstwo Nauki i Szkolnictwa Wyższego" )  </span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="st">dim(funderPoland)</span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="st">#&gt; [1] 20 37</span></a>
<a class="sourceLine" id="cb7-25" title="25"></a>
<a class="sourceLine" id="cb7-26" title="26"><span class="st">osuFunders &lt;- MainEntry %&gt;%</span></a>
<a class="sourceLine" id="cb7-27" title="27"><span class="st">  group_by(`fund-sponsor`) %&gt;%</span></a>
<a class="sourceLine" id="cb7-28" title="28"><span class="st">  tally() %&gt;% </span></a>
<a class="sourceLine" id="cb7-29" title="29"><span class="st">  arrange(desc(n))</span></a>
<a class="sourceLine" id="cb7-30" title="30"><span class="st">osuFunders</span></a>
<a class="sourceLine" id="cb7-31" title="31"><span class="st">#&gt; # A tibble: 17 x 2</span></a>
<a class="sourceLine" id="cb7-32" title="32"><span class="st">#&gt;    `fund-sponsor`                                           n</span></a>
<a class="sourceLine" id="cb7-33" title="33"><span class="st">#&gt;    &lt;chr&gt;                                                &lt;int&gt;</span></a>
<a class="sourceLine" id="cb7-34" title="34"><span class="st">#&gt;  1 Ministerstwo Nauki i Szkolnictwa Wyższego               20</span></a>
<a class="sourceLine" id="cb7-35" title="35"><span class="st">#&gt;  2 &lt;NA&gt;                                                    10</span></a>
<a class="sourceLine" id="cb7-36" title="36"><span class="st">#&gt;  3 National Natural Science Foundation of China             3</span></a>
<a class="sourceLine" id="cb7-37" title="37"><span class="st">#&gt;  4 National Science Foundation                              2</span></a>
<a class="sourceLine" id="cb7-38" title="38"><span class="st">#&gt;  5 Natural Science Foundation of Fujian Province            2</span></a>
<a class="sourceLine" id="cb7-39" title="39"><span class="st">#&gt;  6 Oklahoma State University                                2</span></a>
<a class="sourceLine" id="cb7-40" title="40"><span class="st">#&gt;  7 Australian Research Council                              1</span></a>
<a class="sourceLine" id="cb7-41" title="41"><span class="st">#&gt;  8 Bioenergy Technologies Office                            1</span></a>
<a class="sourceLine" id="cb7-42" title="42"><span class="st">#&gt;  9 China Scholarship Council                                1</span></a>
<a class="sourceLine" id="cb7-43" title="43"><span class="st">#&gt; 10 Fundação de Amparo à Pesquisa do Estado de São Paulo     1</span></a>
<a class="sourceLine" id="cb7-44" title="44"><span class="st">#&gt; 11 Guizhou Science and Technology Department                1</span></a>
<a class="sourceLine" id="cb7-45" title="45"><span class="st">#&gt; 12 Human Frontier Science Program                           1</span></a>
<a class="sourceLine" id="cb7-46" title="46"><span class="st">#&gt; 13 National Institutes of Health                            1</span></a>
<a class="sourceLine" id="cb7-47" title="47"><span class="st">#&gt; 14 Office of Naval Research                                 1</span></a>
<a class="sourceLine" id="cb7-48" title="48"><span class="st">#&gt; 15 Ohio State University                                    1</span></a>
<a class="sourceLine" id="cb7-49" title="49"><span class="st">#&gt; 16 Russian Foundation for Basic Research                    1</span></a>
<a class="sourceLine" id="cb7-50" title="50"><span class="st">#&gt; 17 U.S. Department of Agriculture                           1</span></a></code></pre></div>
</div>
<div id="number-of-author-limits" class="section level2">
<h2 class="hasAnchor">
<a href="#number-of-author-limits" class="anchor"></a>Number of author limits</h2>
<p>In the Scopus API, if there are <span class="math inline">\(&gt; 100\)</span> authors on a paper, it only will retrieve the first 100 authors. For those cases, we must use the <code>abstract_retrieval</code> to get all the author-level information. Here we make this information into an integer so that we can filter the rows we need to run based on author count.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="cf">if</span> (total_results <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="co"># if there are 100+ authors, you have to use the abstract_retrieval function to get the full author data</span></a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="co"># coerce to integer first</span></a>
<a class="sourceLine" id="cb8-5" title="5">  MainEntry &lt;-<span class="st"> </span>MainEntry <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="st">`</span><span class="dt">author-count.$</span><span class="st">`</span> =<span class="st"> </span><span class="kw">as.integer</span>(<span class="st">`</span><span class="dt">author-count.$</span><span class="st">`</span>))</a>
<a class="sourceLine" id="cb8-7" title="7">  run_multi =<span class="st"> </span><span class="kw">any</span>(MainEntry<span class="op">$</span><span class="st">`</span><span class="dt">author-count.$</span><span class="st">`</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">99</span>)</a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="kw">print</span>(run_multi)</a>
<a class="sourceLine" id="cb8-9" title="9">}</a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>In this case, we see there are some articles with author counts <span class="math inline">\(&gt; 99\)</span> and we must get all author information for those.</p>
</div>
<div id="more-than-100-authors" class="section level2">
<h2 class="hasAnchor">
<a href="#more-than-100-authors" class="anchor"></a>More than 100 authors</h2>
<p>Now, the <code>abstract_retrieval</code> function can take a number of identifiers for papers, such as DOI, PubMed ID, and Scopus ID. Here we will use the Scopus ID, as it is given for all results, but we could also use DOI.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="cf">if</span> (total_results <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="cf">if</span> (run_multi) {</a>
<a class="sourceLine" id="cb9-3" title="3">    </a>
<a class="sourceLine" id="cb9-4" title="4">    MainEntry_99auth &lt;-<span class="st"> </span>MainEntry <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="st">`</span><span class="dt">author-count.$</span><span class="st">`</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">99</span>)</a>
<a class="sourceLine" id="cb9-6" title="6">    </a>
<a class="sourceLine" id="cb9-7" title="7">    MainEntry_99auth_id =<span class="st"> </span>MainEntry_99auth <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(entry_number, subj_area)</a>
<a class="sourceLine" id="cb9-9" title="9">    auth99 =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(MainEntry_99auth_id, Authors)</a>
<a class="sourceLine" id="cb9-10" title="10">    affil99 =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(MainEntry_99auth_id, Affiliation)</a>
<a class="sourceLine" id="cb9-11" title="11"></a>
<a class="sourceLine" id="cb9-12" title="12">    </a>
<a class="sourceLine" id="cb9-13" title="13">    missing_table =<span class="st"> </span>MainEntry <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise_all.html">mutate_at</a></span>( <span class="kw"><a href="http://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(scopus_id, doi), <span class="dt">.funs =</span> is.na) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise_all.html">summarize_at</a></span>(<span class="dt">.vars =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(scopus_id, doi), <span class="dt">.funs =</span> sum)</a>
<a class="sourceLine" id="cb9-17" title="17">    <span class="kw">print</span>(missing_table)</a>
<a class="sourceLine" id="cb9-18" title="18">  }</a>
<a class="sourceLine" id="cb9-19" title="19">}</a>
<a class="sourceLine" id="cb9-20" title="20"><span class="co">#&gt; Joining, by = c("entry_number", "subj_area")</span></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co">#&gt; Joining, by = c("entry_number", "subj_area")</span></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="co">#&gt;   scopus_id doi</span></a>
<a class="sourceLine" id="cb9-23" title="23"><span class="co">#&gt; 1         0   0</span></a></code></pre></div>
</div>
<div id="get-all-the-authors" class="section level2">
<h2 class="hasAnchor">
<a href="#get-all-the-authors" class="anchor"></a>Get all the authors</h2>
<p>Here we will go through each Scopus ID and get the article information. We will create an affiliation <code>data.frame</code> and an author <code>data.frame</code>. The non-relevant columns will be deleted, such as <code>entry_number</code> since it refers to a different set of elements from a list now. The column names will be harmonized with the <code>Authors</code> and <code>Affiliation</code> data sets. The respective data is removed from the <code>Authors</code> and <code>Affiliation</code> data set and joined with the new data with the richer information.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="cf">if</span> (total_results <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="co"># ids = MainEntry_99auth$scopus_id[1:3]</span></a>
<a class="sourceLine" id="cb10-3" title="3">  ids =<span class="st"> </span>MainEntry_99auth<span class="op">$</span>scopus_id</a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="kw">names</span>(ids) =<span class="st"> </span>ids</a>
<a class="sourceLine" id="cb10-5" title="5">  big_list =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(</a>
<a class="sourceLine" id="cb10-6" title="6">    ids, </a>
<a class="sourceLine" id="cb10-7" title="7">    abstract_retrieval, </a>
<a class="sourceLine" id="cb10-8" title="8">    <span class="dt">identifier =</span> <span class="st">"scopus_id"</span>,</a>
<a class="sourceLine" id="cb10-9" title="9">    <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb10-10" title="10">  </a>
<a class="sourceLine" id="cb10-11" title="11">  all_affil_df =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(</a>
<a class="sourceLine" id="cb10-12" title="12">    big_list, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb10-13" title="13">      d =<span class="st"> </span><span class="kw"><a href="../reference/gen_entries_to_df.html">gen_entries_to_df</a></span>(</a>
<a class="sourceLine" id="cb10-14" title="14">        x<span class="op">$</span>content<span class="op">$</span><span class="st">`</span><span class="dt">abstracts-retrieval-response</span><span class="st">`</span><span class="op">$</span>affiliation)</a>
<a class="sourceLine" id="cb10-15" title="15">      d<span class="op">$</span>df</a>
<a class="sourceLine" id="cb10-16" title="16">    }, <span class="dt">.id =</span> <span class="st">"scopus_id"</span>)  </a>
<a class="sourceLine" id="cb10-17" title="17">  </a>
<a class="sourceLine" id="cb10-18" title="18">  all_df =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(</a>
<a class="sourceLine" id="cb10-19" title="19">    big_list, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb10-20" title="20">      d =<span class="st"> </span><span class="kw"><a href="../reference/gen_entries_to_df.html">gen_entries_to_df</a></span>(</a>
<a class="sourceLine" id="cb10-21" title="21">        x<span class="op">$</span>content<span class="op">$</span><span class="st">`</span><span class="dt">abstracts-retrieval-response</span><span class="st">`</span><span class="op">$</span>authors<span class="op">$</span>author)</a>
<a class="sourceLine" id="cb10-22" title="22">      d<span class="op">$</span>df</a>
<a class="sourceLine" id="cb10-23" title="23">    }, <span class="dt">.id =</span> <span class="st">"scopus_id"</span>)</a>
<a class="sourceLine" id="cb10-24" title="24">  </a>
<a class="sourceLine" id="cb10-25" title="25">  <span class="co">##########################</span></a>
<a class="sourceLine" id="cb10-26" title="26">  <span class="co"># Remove prefix ce: for harmonization</span></a>
<a class="sourceLine" id="cb10-27" title="27">  <span class="co">##########################</span></a>
<a class="sourceLine" id="cb10-28" title="28">  no_ce =<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb10-29" title="29">    <span class="kw">sub</span>(<span class="st">"^ce:"</span>, <span class="st">""</span>, x)</a>
<a class="sourceLine" id="cb10-30" title="30">  }</a>
<a class="sourceLine" id="cb10-31" title="31">  all_df =<span class="st"> </span>all_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-32" title="32"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select_all.html">rename_all</a></span>(<span class="dt">.funs =</span> no_ce) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-33" title="33"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">authid =</span> <span class="st">"@auid"</span>,</a>
<a class="sourceLine" id="cb10-34" title="34">           <span class="st">`</span><span class="dt">afid.$</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">affiliation.@id</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb10-35" title="35">           <span class="dt">authname =</span> <span class="st">"indexed-name"</span>)</a>
<a class="sourceLine" id="cb10-36" title="36">  </a>
<a class="sourceLine" id="cb10-37" title="37">  all_df<span class="op">$</span>entry_number =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb10-38" title="38">  all_affil_df<span class="op">$</span>entry_number =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb10-39" title="39">  </a>
<a class="sourceLine" id="cb10-40" title="40">  author_table =<span class="st"> </span>all_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-41" title="41"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(scopus_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-42" title="42"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(authid) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-43" title="43"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tally.html">tally</a></span>()</a>
<a class="sourceLine" id="cb10-44" title="44">  <span class="kw">head</span>(author_table)</a>
<a class="sourceLine" id="cb10-45" title="45">  <span class="kw">stopifnot</span>(<span class="kw">all</span>(ids <span class="op">%in%</span><span class="st"> </span>author_table<span class="op">$</span>scopus_id))</a>
<a class="sourceLine" id="cb10-46" title="46">  <span class="co"># harmonizing with MainEntry</span></a>
<a class="sourceLine" id="cb10-47" title="47">  author_table =<span class="st"> </span>author_table <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-48" title="48"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="st">`</span><span class="dt">author-count.$</span><span class="st">`</span> =<span class="st"> </span>n)</a>
<a class="sourceLine" id="cb10-49" title="49">  MainEntry_99auth<span class="op">$</span><span class="st">`</span><span class="dt">author-count.$</span><span class="st">`</span> =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb10-50" title="50">  MainEntry_99auth =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(MainEntry_99auth, author_table)</a>
<a class="sourceLine" id="cb10-51" title="51">  </a>
<a class="sourceLine" id="cb10-52" title="52">  </a>
<a class="sourceLine" id="cb10-53" title="53">  <span class="co">#######################</span></a>
<a class="sourceLine" id="cb10-54" title="54">  <span class="co"># Harmonized</span></a>
<a class="sourceLine" id="cb10-55" title="55">  <span class="co">#######################</span></a>
<a class="sourceLine" id="cb10-56" title="56">  all_df =<span class="st"> </span>MainEntry_99auth <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-57" title="57"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(entry_number, subj_area, scopus_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-58" title="58"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(all_df)</a>
<a class="sourceLine" id="cb10-59" title="59">  <span class="kw">print</span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/setops.html">setdiff</a></span>(<span class="kw">colnames</span>(Authors), <span class="kw">colnames</span>(all_df)))</a>
<a class="sourceLine" id="cb10-60" title="60">  </a>
<a class="sourceLine" id="cb10-61" title="61">  <span class="co"># grab only relevant columns</span></a>
<a class="sourceLine" id="cb10-62" title="62">  all_df =<span class="st"> </span>all_df[, <span class="kw">colnames</span>(Authors)]</a>
<a class="sourceLine" id="cb10-63" title="63">  </a>
<a class="sourceLine" id="cb10-64" title="64">  <span class="co"># remove the old entries</span></a>
<a class="sourceLine" id="cb10-65" title="65">  Authors =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">anti_join</a></span>(Authors, MainEntry_99auth_id)</a>
<a class="sourceLine" id="cb10-66" title="66">  <span class="co"># put the new data in</span></a>
<a class="sourceLine" id="cb10-67" title="67">  Authors =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">full_join</a></span>(Authors, all_df)</a>
<a class="sourceLine" id="cb10-68" title="68">  </a>
<a class="sourceLine" id="cb10-69" title="69">  <span class="co">#######################</span></a>
<a class="sourceLine" id="cb10-70" title="70">  <span class="co"># Harmonized</span></a>
<a class="sourceLine" id="cb10-71" title="71">  <span class="co">#######################  </span></a>
<a class="sourceLine" id="cb10-72" title="72">  all_affil_df =<span class="st"> </span>all_affil_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-73" title="73"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="st">`</span><span class="dt">affiliation-url</span><span class="st">`</span> =<span class="st"> "@href"</span>,</a>
<a class="sourceLine" id="cb10-74" title="74">           <span class="dt">afid =</span> <span class="st">"@id"</span>)</a>
<a class="sourceLine" id="cb10-75" title="75">  all_affil_df =<span class="st"> </span>MainEntry_99auth <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-76" title="76"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(entry_number, subj_area, scopus_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-77" title="77"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(all_affil_df)  </a>
<a class="sourceLine" id="cb10-78" title="78">  <span class="kw"><a href="http://dplyr.tidyverse.org/reference/setops.html">setdiff</a></span>(<span class="kw">colnames</span>(Affiliation), <span class="kw">colnames</span>(all_affil_df))  </a>
<a class="sourceLine" id="cb10-79" title="79">  </a>
<a class="sourceLine" id="cb10-80" title="80">  <span class="co"># remove the old entries</span></a>
<a class="sourceLine" id="cb10-81" title="81">  Affiliation =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">anti_join</a></span>(Affiliation, MainEntry_99auth_id)</a>
<a class="sourceLine" id="cb10-82" title="82">  <span class="co"># put the new data in</span></a>
<a class="sourceLine" id="cb10-83" title="83">  Affiliation =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">full_join</a></span>(Affiliation, all_affil_df)</a>
<a class="sourceLine" id="cb10-84" title="84">  </a>
<a class="sourceLine" id="cb10-85" title="85">  MainEntry =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">anti_join</a></span>(MainEntry, MainEntry_99auth_id)</a>
<a class="sourceLine" id="cb10-86" title="86">  MainEntry =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">full_join</a></span>(MainEntry, MainEntry_99auth)</a>
<a class="sourceLine" id="cb10-87" title="87">}</a>
<a class="sourceLine" id="cb10-88" title="88"><span class="co">#&gt; Joining, by = "scopus_id"</span></a>
<a class="sourceLine" id="cb10-89" title="89"><span class="co">#&gt; Joining, by = "scopus_id"</span></a>
<a class="sourceLine" id="cb10-90" title="90"><span class="co">#&gt; character(0)</span></a>
<a class="sourceLine" id="cb10-91" title="91"><span class="co">#&gt; Joining, by = c("entry_number", "subj_area")</span></a>
<a class="sourceLine" id="cb10-92" title="92"><span class="co">#&gt; Joining, by = c("entry_number", "subj_area", "@_fa", "@seq", "author-url", "authid", "authname", "surname", "given-name", "initials", "afid.$")</span></a>
<a class="sourceLine" id="cb10-93" title="93"><span class="co">#&gt; Joining, by = "scopus_id"</span></a>
<a class="sourceLine" id="cb10-94" title="94"><span class="co">#&gt; Joining, by = c("entry_number", "subj_area")</span></a>
<a class="sourceLine" id="cb10-95" title="95"><span class="co">#&gt; Joining, by = c("entry_number", "subj_area", "affiliation-url", "afid", "affilname", "affiliation-city", "affiliation-country")</span></a>
<a class="sourceLine" id="cb10-96" title="96"><span class="co">#&gt; Joining, by = c("subj_area", "entry_number")</span></a>
<a class="sourceLine" id="cb10-97" title="97"><span class="co">#&gt; Joining, by = c("subj_area", "@_fa", "prism:url", "dc:identifier", "eid", "dc:title", "dc:creator", "prism:publicationName", "prism:issn", "prism:eIssn", "prism:volume", "prism:issueIdentifier", "prism:pageRange", "prism:coverDate", "prism:coverDisplayDate", "prism:doi", "dc:description", "citedby-count", "prism:aggregationType", "subtype", "subtypeDescription", "author-count.@limit", "author-count.$", "authkeywords", "source-id", "fund-no", "openaccess", "openaccessFlag", "entry_number", "article-number", "fund-acr", "fund-sponsor", "pii", "message", "pubmed-id", "scopus_id", "doi")</span></a></code></pre></div>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>The Scopus API has limits for different searches and calls. Using a combination of APIs, we can gather all the information on authors that we would like. This gives us a full picture of the authors and co-authorship at a specific institution in specific scenarios, such as the open access publications from 2018.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#creating-a-query">Creating a query</a></li>
      <li><a href="#running-the-query">Running the query</a></li>
      <li><a href="#getting-the-content">Getting the content</a></li>
      <li><a href="#funding-agencies">Funding agencies</a></li>
      <li><a href="#number-of-author-limits">Number of author limits</a></li>
      <li><a href="#more-than-100-authors">More than 100 authors</a></li>
      <li><a href="#get-all-the-authors">Get all the authors</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by John Muschelli.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
